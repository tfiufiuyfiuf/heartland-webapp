# ğŸ’ª æœ€ç»ˆè§£å†³æ–¹æ¡ˆ - ç®€åŒ–é…ç½®

## ğŸ¯ æ–°ç­–ç•¥

æˆ‘é‡‡ç”¨äº†æœ€ç®€å•ç›´æ¥çš„æ–¹æ³•ï¼š

1. âŒ åˆ é™¤ `api/index.js`
2. âœ… ä½¿ç”¨ `rewrites` ç›´æ¥è·¯ç”±åˆ° `server.js`
3. âœ… ç®€åŒ– CORS é…ç½®ï¼Œä½¿ç”¨æœ€åŸºç¡€çš„æ–¹æ³•

---

## âœ… ä¿®æ”¹å†…å®¹

### 1. `vercel.json` - æœ€ç®€é…ç½®
```json
{
  "version": 2,
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/server.js"
    }
  ]
}
```

### 2. `server.js` - ç®€åŒ– CORS
```javascript
// CORSé…ç½® - æœ€ç®€å•ç›´æ¥çš„æ–¹å¼
app.use((req, res, next) => {
  const origin = req.headers.origin || '*';
  res.setHeader('Access-Control-Allow-Origin', origin);
  res.setHeader('Access-Control-Allow-Credentials', 'true');
  res.setHeader('Access-Control-Allow-Methods', 'GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS');
  res.setHeader('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept, Authorization');
  res.setHeader('Access-Control-Max-Age', '86400');
  
  // ç«‹å³å“åº” OPTIONS è¯·æ±‚
  if (req.method === 'OPTIONS') {
    res.status(204).end();
    return;
  }
  
  next();
});
```

### 3. åˆ é™¤çš„æ–‡ä»¶
- âŒ `backend/api/index.js`
- âŒ `backend/api/auth/register.js`
- âŒ `backend/api/auth/login.js`
- âŒ `backend/api/health.js`

ç°åœ¨ `backend/api/` æ–‡ä»¶å¤¹åº”è¯¥æ˜¯ç©ºçš„æˆ–åªæœ‰å…¶ä»–ä¸ç›¸å…³çš„æ–‡ä»¶ã€‚

---

## ğŸš€ æµ‹è¯•æ­¥éª¤

### 1. ç­‰å¾… 2 åˆ†é’Ÿ
è¿™æ¬¡æ”¹åŠ¨å¾ˆå¤§ï¼Œéœ€è¦æ›´å¤šæ—¶é—´è®© Vercel å®Œå…¨éƒ¨ç½²ã€‚

### 2. æ¸…é™¤æ‰€æœ‰ç¼“å­˜
- æŒ‰ `Ctrl + Shift + Delete`
- é€‰æ‹©ï¼š
  - âœ… æµè§ˆå†å²è®°å½•
  - âœ… Cookie å’Œå…¶ä»–ç½‘ç«™æ•°æ®
  - âœ… ç¼“å­˜çš„å›¾ç‰‡å’Œæ–‡ä»¶
- æ—¶é—´èŒƒå›´ï¼šå…¨éƒ¨æ—¶é—´
- ç‚¹å‡» "æ¸…é™¤æ•°æ®"

### 3. é‡å¯æµè§ˆå™¨
å®Œå…¨å…³é—­æµè§ˆå™¨ï¼Œç„¶åé‡æ–°æ‰“å¼€ã€‚

### 4. ä½¿ç”¨æ— ç—•æ¨¡å¼æµ‹è¯•
- æŒ‰ `Ctrl + Shift + N` (Chrome)
- æ‰“å¼€ï¼š`https://heartland-webapp.vercel.app/student-login.html`

### 5. æ³¨å†Œæµ‹è¯•
- æ‰‹æœºå·ï¼š`13900139006`
- ç‚¹å‡» "å‘é€éªŒè¯ç "
- éªŒè¯ç ï¼š`123456`
- ç”¨æˆ·åï¼š`æµ‹è¯•å­¦ç”Ÿ07`
- å¯†ç ï¼š`123456`
- ç‚¹å‡» "æ³¨å†Œ"

### 6. æŸ¥çœ‹ç»“æœ
- æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
- æŸ¥çœ‹ Console æ ‡ç­¾
- æŸ¥çœ‹ Network æ ‡ç­¾
- æ‰¾åˆ° `/api/auth/register` è¯·æ±‚
- æŸ¥çœ‹ Response Headers æ˜¯å¦æœ‰ `Access-Control-Allow-Origin`

---

## ğŸ” å¦‚ä½•éªŒè¯ CORS æ˜¯å¦ä¿®å¤

### åœ¨ Network æ ‡ç­¾ä¸­æŸ¥çœ‹
1. æ‰¾åˆ° `/api/auth/register` è¯·æ±‚
2. ç‚¹å‡»å®ƒ
3. æŸ¥çœ‹ "Headers" æ ‡ç­¾
4. æ‰¾åˆ° "Response Headers"
5. åº”è¯¥çœ‹åˆ°ï¼š
   ```
   Access-Control-Allow-Origin: https://heartland-webapp.vercel.app
   Access-Control-Allow-Credentials: true
   Access-Control-Allow-Methods: GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS
   ```

### å¦‚æœè¿˜æ˜¯çœ‹ä¸åˆ°è¿™äº›å¤´éƒ¨
è¯´æ˜è¯·æ±‚æ ¹æœ¬æ²¡åˆ°è¾¾ `server.js`ï¼Œå¯èƒ½æ˜¯ï¼š
1. Vercel è·¯ç”±é…ç½®é—®é¢˜
2. ç¼“å­˜é—®é¢˜
3. éƒ¨ç½²æœªå®Œæˆ

---

## ğŸ“‹ ä¸ºä»€ä¹ˆè¿™æ¬¡åº”è¯¥å¯ä»¥ï¼Ÿ

### ä¹‹å‰çš„é—®é¢˜
1. æœ‰æ—§çš„ `api/` æ–‡ä»¶å¤¹ä¸‹çš„ serverless å‡½æ•°
2. Vercel è·¯ç”±æ··ä¹±ï¼Œä¸çŸ¥é“ç”¨å“ªä¸ª
3. CORS é…ç½®è¢«æ—§æ–‡ä»¶è¦†ç›–

### ç°åœ¨çš„è§£å†³æ–¹æ¡ˆ
1. âœ… åˆ é™¤æ‰€æœ‰ `api/` ä¸‹çš„æ–‡ä»¶
2. âœ… ä½¿ç”¨ `rewrites` æ˜ç¡®è·¯ç”±åˆ° `server.js`
3. âœ… ç®€åŒ– CORS é…ç½®ï¼Œä½¿ç”¨æœ€åŸºç¡€çš„ `setHeader` æ–¹æ³•
4. âœ… åœ¨æ‰€æœ‰ä¸­é—´ä»¶ä¹‹å‰å¤„ç† CORS

---

## ğŸ†˜ å¦‚æœè¿˜æ˜¯ä¸è¡Œ

### æ–¹æ¡ˆ Aï¼šæŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
```bash
vercel logs heartland-backend --prod
```

### æ–¹æ¡ˆ Bï¼šæµ‹è¯•å¥åº·æ£€æŸ¥
åœ¨æµè§ˆå™¨æ‰“å¼€ï¼š
```
https://heartland-backend.vercel.app/health
```

æŸ¥çœ‹æ˜¯å¦è¿”å› JSONï¼Œä»¥åŠ Response Headers æ˜¯å¦æœ‰ CORS å¤´éƒ¨ã€‚

### æ–¹æ¡ˆ Cï¼šç›´æ¥ç”¨ curl æµ‹è¯•
```bash
curl -X OPTIONS https://heartland-backend.vercel.app/api/auth/register -H "Origin: https://heartland-webapp.vercel.app" -v
```

æŸ¥çœ‹è¿”å›çš„å¤´éƒ¨ä¿¡æ¯ã€‚

### æ–¹æ¡ˆ Dï¼šå‘Šè¯‰æˆ‘è¯¦ç»†ä¿¡æ¯
å¦‚æœè¿˜æ˜¯ä¸è¡Œï¼Œè¯·å‘Šè¯‰æˆ‘ï¼š
1. Network æ ‡ç­¾ä¸­ `/api/auth/register` çš„å®Œæ•´ Response Headers
2. Console æ ‡ç­¾ä¸­çš„æ‰€æœ‰é”™è¯¯ä¿¡æ¯
3. æ˜¯å¦ä½¿ç”¨äº†æ— ç—•æ¨¡å¼æµ‹è¯•
4. æ˜¯å¦ç­‰å¾…äº† 2 åˆ†é’Ÿ

---

## ğŸ’¡ æ¸©é¦¨æç¤º

### ä¸€å®šè¦åšçš„äº‹
1. âœ… ç­‰å¾… 2 åˆ†é’Ÿ
2. âœ… æ¸…é™¤æ‰€æœ‰ç¼“å­˜
3. âœ… é‡å¯æµè§ˆå™¨
4. âœ… ä½¿ç”¨æ— ç—•æ¨¡å¼
5. âœ… æŒ‰ F12 æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯

### ä¸è¦åšçš„äº‹
1. âŒ ä¸è¦ç«‹å³æµ‹è¯•ï¼ˆç­‰å¾… 2 åˆ†é’Ÿï¼‰
2. âŒ ä¸è¦ç”¨æ—§çš„æµè§ˆå™¨çª—å£
3. âŒ ä¸è¦è·³è¿‡æ¸…é™¤ç¼“å­˜æ­¥éª¤

---

**è¯·ä¸¥æ ¼æŒ‰ç…§æ­¥éª¤æ“ä½œï¼Œ2 åˆ†é’Ÿåå‘Šè¯‰æˆ‘ç»“æœï¼** ğŸ’ª

è¿™æ¬¡æˆ‘ç”¨äº†æœ€ç®€å•ç›´æ¥çš„æ–¹æ³•ï¼Œå¦‚æœè¿˜ä¸è¡Œï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹æ›´è¯¦ç»†çš„æ—¥å¿—å’Œé…ç½®ã€‚















