# 🔧 404 和 400 错误诊断

## 错误信息

1. ❌ 404 错误 - `heartland-backend.onrender.com/api/auth/login`
2. ❌ 400 错误 - 登录失败

## 快速诊断步骤

### 步骤 1：测试健康检查（确认服务运行）

在浏览器访问：
```
https://heartland-backend.onrender.com/health
```

**如果返回 404 或无法访问**：
- 服务可能还在启动
- 等待 1-2 分钟后再试

**如果返回 JSON**：
- 服务正常运行 ✅
- 继续下一步

---

### 步骤 2：测试登录接口（使用浏览器控制台）

1. **打开前端页面**
   - 访问：https://heartland-webapp.vercel.app/index.html

2. **打开浏览器控制台**
   - 按 `F12` 打开开发者工具
   - 切换到 **Console** 标签

3. **在控制台运行测试代码**

```javascript
// 测试后端连接
fetch('https://heartland-backend.onrender.com/health')
  .then(res => res.json())
  .then(data => console.log('健康检查:', data))
  .catch(err => console.error('健康检查失败:', err));

// 测试登录接口
fetch('https://heartland-backend.onrender.com/api/auth/login', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    phone: '13800138000',
    password: '123456'
  })
})
  .then(res => res.json())
  .then(data => console.log('登录测试:', data))
  .catch(err => console.error('登录失败:', err));
```

4. **查看控制台输出**
   - 如果看到 "用户名或密码错误" → 接口正常，只是用户不存在
   - 如果看到其他错误 → 记录错误信息

---

### 步骤 3：检查 Render 服务日志

1. **打开 Render Dashboard**
   - 进入 `heartland-backend` 服务
   - 点击 **"Logs"** 标签

2. **查看最新日志**
   - 查找是否有错误信息
   - 查找登录请求的日志

3. **查看是否有以下日志**：
   ```
   登录请求数据: { phone: '...', password: '...' }
   ```

---

### 步骤 4：检查前端配置

1. **打开浏览器开发者工具**
   - 按 `F12`
   - 切换到 **Network** 标签

2. **尝试登录**
   - 输入手机号和密码
   - 点击登录

3. **查看网络请求**
   - 找到 `login` 请求
   - 检查：
     - Request URL 是否正确：`https://heartland-backend.onrender.com/api/auth/login`
     - Request Method 是否为 `POST`
     - Request Headers 是否包含 `Content-Type: application/json`
     - Request Payload 是否正确

4. **查看响应**
   - 点击请求
   - 查看 Response 标签
   - 复制完整的错误信息

---

## 可能的原因和解决方案

### 原因 1：服务还在启动

**症状**：健康检查返回 404

**解决**：
- 等待 2-3 分钟
- 刷新页面重试

---

### 原因 2：用户不存在

**症状**：400 错误 - "用户名或密码错误"

**解决**：
- 需要先注册用户
- 在前端页面点击注册
- 填写信息后创建账号

---

### 原因 3：验证码错误

**症状**：注册时 400 错误 - "验证码错误"

**解决**：
- 使用固定验证码：`123456`
- 确保输入的是 6 位数字

---

### 原因 4：CORS 问题

**症状**：
```
Access to fetch at '...' has been blocked by CORS policy
```

**解决**：
1. 在 Render Dashboard 中
2. 进入服务 → Settings → Environment
3. 确保有环境变量：
   ```
   FRONTEND_URL=https://heartland-webapp.vercel.app
   ```
4. 保存后重新部署

---

### 原因 5：前端配置错误

**症状**：请求发送到错误的 URL

**解决**：
1. 检查 `heartland-webapp/frontend/config.js`
2. 确认 `BASE_URL` 为：
   ```javascript
   BASE_URL: 'https://heartland-backend.onrender.com/api',
   ```
3. 注意末尾有 `/api` 和逗号

---

## 请提供以下信息

为了更好地帮您诊断，请提供：

1. **健康检查结果**
   - 访问 `/health` 返回什么？

2. **控制台测试结果**
   - 运行上面的测试代码后，输出什么？

3. **Network 请求详情**
   - Request URL 是什么？
   - Response 返回什么内容？

4. **Render 日志**
   - 日志中有没有错误信息？
   - 看到登录请求的日志了吗？

---

## 快速测试命令

复制到浏览器控制台运行：

```javascript
// 完整测试
console.log('开始测试...');

// 1. 测试健康检查
fetch('https://heartland-backend.onrender.com/health')
  .then(res => res.json())
  .then(data => {
    console.log('✅ 健康检查成功:', data);
    
    // 2. 测试登录接口
    return fetch('https://heartland-backend.onrender.com/api/auth/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ phone: '13800138000', password: '123456' })
    });
  })
  .then(res => res.json())
  .then(data => {
    console.log('登录接口响应:', data);
    if (data.success) {
      console.log('✅ 登录成功');
    } else {
      console.log('⚠️ 登录失败:', data.message);
    }
  })
  .catch(err => {
    console.error('❌ 测试失败:', err);
  });
```

---

## 现在请执行

1. ✅ 测试健康检查
2. ✅ 在控制台运行测试代码
3. ✅ 查看 Network 请求详情
4. ✅ 把结果告诉我

我会根据具体情况继续协助！


