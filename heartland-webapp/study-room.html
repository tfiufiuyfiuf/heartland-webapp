<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸“æ³¨è‡ªä¹ å®¤ - å¿ƒå±¿å­¦é™¢</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="./frontend/config.js"></script>
    <script src="./frontend/api.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .container {
            width: 90%;
            max-width: 600px;
            text-align: center;
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .timer-display {
            font-size: 120px;
            font-weight: 700;
            margin: 40px 0;
            font-variant-numeric: tabular-nums;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .timer-label {
            font-size: 24px;
            margin-bottom: 40px;
            opacity: 0.9;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .preset-btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 20px;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
        }

        .preset-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }

        .preset-btn.active {
            background: rgba(255, 255, 255, 0.3);
            border-color: white;
        }

        .control-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .control-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            font-size: 32px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .start-btn {
            background: linear-gradient(135deg, #00C48C, #00a896);
            color: white;
        }

        .start-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 196, 140, 0.4);
        }

        .pause-btn {
            background: linear-gradient(135deg, #FFA940, #ff8c00);
            color: white;
        }

        .pause-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(255, 169, 64, 0.4);
        }

        .reset-btn {
            background: linear-gradient(135deg, #FF4D6D, #e63946);
            color: white;
        }

        .reset-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(255, 77, 109, 0.4);
        }

        .stats {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.8;
        }

        .music-player {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .music-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .music-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .custom-time {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .custom-time input {
            width: 80px;
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            color: white;
            text-align: center;
            font-size: 18px;
        }

        .custom-time input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .motivational-quote {
            margin-top: 30px;
            font-size: 18px;
            font-style: italic;
            opacity: 0.8;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .timer-display.running {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="goBack()">
        <i class="fas fa-arrow-left"></i> è¿”å›
    </button>

    <div class="container">
        <h1 style="font-size: 36px; margin-bottom: 20px;">ğŸ“š ä¸“æ³¨è‡ªä¹ å®¤</h1>
        <p class="timer-label" id="timerLabel">é€‰æ‹©ä¸“æ³¨æ—¶é•¿</p>

        <!-- é¢„è®¾æ—¶é•¿ -->
        <div class="preset-buttons">
            <button class="preset-btn" onclick="setTime(25)">
                <div style="font-size: 24px; margin-bottom: 5px;">ğŸ…</div>
                <div>25 åˆ†é’Ÿ</div>
                <div style="font-size: 12px; opacity: 0.7;">ç•ªèŒ„å·¥ä½œæ³•</div>
            </button>
            <button class="preset-btn" onclick="setTime(45)">
                <div style="font-size: 24px; margin-bottom: 5px;">ğŸ“–</div>
                <div>45 åˆ†é’Ÿ</div>
                <div style="font-size: 12px; opacity: 0.7;">ä¸€èŠ‚è¯¾</div>
            </button>
            <button class="preset-btn" onclick="setTime(60)">
                <div style="font-size: 24px; margin-bottom: 5px;">â°</div>
                <div>60 åˆ†é’Ÿ</div>
                <div style="font-size: 12px; opacity: 0.7;">æ·±åº¦ä¸“æ³¨</div>
            </button>
        </div>

        <!-- è‡ªå®šä¹‰æ—¶é•¿ -->
        <div class="custom-time">
            <input type="number" id="customMinutes" placeholder="åˆ†é’Ÿ" min="1" max="180">
            <button class="preset-btn" onclick="setCustomTime()" style="padding: 12px 24px;">
                è®¾ç½®
            </button>
        </div>

        <!-- è®¡æ—¶å™¨æ˜¾ç¤º -->
        <div class="timer-display" id="timerDisplay">25:00</div>

        <!-- æ§åˆ¶æŒ‰é’® -->
        <div class="control-buttons">
            <button class="control-btn start-btn" id="startBtn" onclick="startTimer()">
                <i class="fas fa-play"></i>
            </button>
            <button class="control-btn pause-btn" id="pauseBtn" onclick="pauseTimer()" style="display: none;">
                <i class="fas fa-pause"></i>
            </button>
            <button class="control-btn reset-btn" onclick="resetTimer()">
                <i class="fas fa-redo"></i>
            </button>
        </div>

        <!-- åŠ±å¿—è¯­å½• -->
        <div class="motivational-quote" id="quote">
            "ä¸“æ³¨æ˜¯é€šå¾€æˆåŠŸçš„å”¯ä¸€é“è·¯ã€‚"
        </div>

        <!-- ç»Ÿè®¡æ•°æ® -->
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="todaySessions">0</div>
                <div class="stat-label">ä»Šæ—¥ä¸“æ³¨</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="todayMinutes">0</div>
                <div class="stat-label">ä¸“æ³¨åˆ†é’Ÿ</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalSessions">0</div>
                <div class="stat-label">ç´¯è®¡æ¬¡æ•°</div>
            </div>
        </div>
    </div>

    <!-- èƒŒæ™¯éŸ³ä¹æ§åˆ¶ -->
    <div class="music-player">
        <button class="music-btn" onclick="toggleMusic()">
            <i class="fas fa-music" id="musicIcon"></i>
        </button>
        <span id="musicLabel">ç™½å™ªéŸ³</span>
    </div>

    <!-- éŸ³é¢‘å…ƒç´ ï¼ˆå¯é€‰ï¼‰ -->
    <audio id="bgMusic" loop>
        <!-- å¯ä»¥æ·»åŠ ç™½å™ªéŸ³éŸ³é¢‘æº -->
    </audio>

    <script>
        let timeLeft = 25 * 60; // ç§’
        let totalTime = 25 * 60;
        let timerInterval = null;
        let isRunning = false;
        let sessionCount = 0;
        let totalMinutes = 0;

        const quotes = [
            "ä¸“æ³¨æ˜¯é€šå¾€æˆåŠŸçš„å”¯ä¸€é“è·¯ã€‚",
            "æ¯ä¸€åˆ†é’Ÿçš„åŠªåŠ›ï¼Œéƒ½æ˜¯æœªæ¥çš„ç§¯ç´¯ã€‚",
            "ä¿æŒä¸“æ³¨ï¼Œä½ æ­£åœ¨å˜å¾—æ›´å¥½ã€‚",
            "æˆåŠŸå±äºé‚£äº›ä¸“æ³¨ä¸”åšæŒçš„äººã€‚",
            "ä¸“æ³¨å½“ä¸‹ï¼Œæœªæ¥è‡ªç„¶ç¾å¥½ã€‚",
            "ä½ çš„ä¸“æ³¨æ—¶å…‰ï¼Œæ­£åœ¨å¡‘é€ æ›´å¥½çš„è‡ªå·±ã€‚",
            "é™ä¸‹å¿ƒæ¥ï¼Œä¸“æ³¨çœ¼å‰çš„äº‹ã€‚",
            "æ¯ä¸€æ¬¡ä¸“æ³¨ï¼Œéƒ½æ˜¯ä¸€æ¬¡æˆé•¿ã€‚"
        ];

        // é¡µé¢åŠ è½½
        window.addEventListener('DOMContentLoaded', () => {
            loadStats();
            updateQuote();
        });

        // è®¾ç½®æ—¶é—´
        function setTime(minutes) {
            if (isRunning) {
                if (!confirm('æ­£åœ¨ä¸“æ³¨ä¸­ï¼Œç¡®å®šè¦åˆ‡æ¢å—ï¼Ÿ')) {
                    return;
                }
                resetTimer();
            }

            totalTime = minutes * 60;
            timeLeft = totalTime;
            updateDisplay();

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.preset-btn')?.classList.add('active');
        }

        // è‡ªå®šä¹‰æ—¶é—´
        function setCustomTime() {
            const minutes = parseInt(document.getElementById('customMinutes').value);
            if (!minutes || minutes < 1 || minutes > 180) {
                alert('è¯·è¾“å…¥ 1-180 ä¹‹é—´çš„åˆ†é’Ÿæ•°');
                return;
            }
            setTime(minutes);
        }

        // å¼€å§‹è®¡æ—¶
        function startTimer() {
            if (isRunning) return;

            isRunning = true;
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('pauseBtn').style.display = 'flex';
            document.getElementById('timerLabel').textContent = 'ä¸“æ³¨ä¸­...';
            document.getElementById('timerDisplay').classList.add('running');

            timerInterval = setInterval(() => {
                timeLeft--;
                updateDisplay();

                if (timeLeft <= 0) {
                    completeSession();
                }
            }, 1000);
        }

        // æš‚åœè®¡æ—¶
        function pauseTimer() {
            if (!isRunning) return;

            isRunning = false;
            clearInterval(timerInterval);
            document.getElementById('startBtn').style.display = 'flex';
            document.getElementById('pauseBtn').style.display = 'none';
            document.getElementById('timerLabel').textContent = 'å·²æš‚åœ';
            document.getElementById('timerDisplay').classList.remove('running');
        }

        // é‡ç½®è®¡æ—¶
        function resetTimer() {
            if (isRunning && !confirm('ç¡®å®šè¦é‡ç½®è®¡æ—¶å™¨å—ï¼Ÿ')) {
                return;
            }

            isRunning = false;
            clearInterval(timerInterval);
            timeLeft = totalTime;
            updateDisplay();

            document.getElementById('startBtn').style.display = 'flex';
            document.getElementById('pauseBtn').style.display = 'none';
            document.getElementById('timerLabel').textContent = 'é€‰æ‹©ä¸“æ³¨æ—¶é•¿';
            document.getElementById('timerDisplay').classList.remove('running');
        }

        // å®Œæˆä¸€æ¬¡ä¸“æ³¨
        function completeSession() {
            isRunning = false;
            clearInterval(timerInterval);

            // æ’­æ”¾å®ŒæˆéŸ³æ•ˆï¼ˆå¯é€‰ï¼‰
            playCompletionSound();

            // æ›´æ–°ç»Ÿè®¡
            sessionCount++;
            const minutes = Math.floor(totalTime / 60);
            totalMinutes += minutes;

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            saveStats();

            // æ˜¾ç¤ºå®Œæˆæç¤º
            document.getElementById('timerLabel').textContent = 'ğŸ‰ ä¸“æ³¨å®Œæˆï¼';
            document.getElementById('timerDisplay').textContent = '00:00';
            document.getElementById('timerDisplay').classList.remove('running');

            alert(`æ­å–œå®Œæˆ ${minutes} åˆ†é’Ÿçš„ä¸“æ³¨ï¼\n\nä»Šæ—¥å·²å®Œæˆ ${sessionCount} æ¬¡ä¸“æ³¨ï¼Œå…± ${totalMinutes} åˆ†é’Ÿã€‚`);

            // é‡ç½®è®¡æ—¶å™¨
            setTimeout(() => {
                resetTimer();
                updateQuote();
            }, 2000);
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timerDisplay').textContent = 
                `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        // æ›´æ–°åŠ±å¿—è¯­å½•
        function updateQuote() {
            const quote = quotes[Math.floor(Math.random() * quotes.length)];
            document.getElementById('quote').textContent = `"${quote}"`;
        }

        // åŠ è½½ç»Ÿè®¡
        function loadStats() {
            const today = new Date().toDateString();
            const savedDate = localStorage.getItem('studyroom_date');
            
            if (savedDate === today) {
                sessionCount = parseInt(localStorage.getItem('studyroom_sessions') || '0');
                totalMinutes = parseInt(localStorage.getItem('studyroom_minutes') || '0');
            } else {
                sessionCount = 0;
                totalMinutes = 0;
                localStorage.setItem('studyroom_date', today);
            }

            const totalSessions = parseInt(localStorage.getItem('studyroom_total_sessions') || '0');

            document.getElementById('todaySessions').textContent = sessionCount;
            document.getElementById('todayMinutes').textContent = totalMinutes;
            document.getElementById('totalSessions').textContent = totalSessions;
        }

        // ä¿å­˜ç»Ÿè®¡
        function saveStats() {
            localStorage.setItem('studyroom_sessions', sessionCount);
            localStorage.setItem('studyroom_minutes', totalMinutes);
            
            const totalSessions = parseInt(localStorage.getItem('studyroom_total_sessions') || '0');
            localStorage.setItem('studyroom_total_sessions', totalSessions + 1);

            loadStats();
        }

        // åˆ‡æ¢éŸ³ä¹
        function toggleMusic() {
            const audio = document.getElementById('bgMusic');
            const icon = document.getElementById('musicIcon');
            
            if (audio.paused) {
                // è¿™é‡Œå¯ä»¥è®¾ç½®ç™½å™ªéŸ³éŸ³é¢‘æº
                // audio.src = 'path/to/white-noise.mp3';
                // audio.play();
                icon.className = 'fas fa-volume-up';
                alert('ç™½å™ªéŸ³åŠŸèƒ½å¾…æ¥å…¥éŸ³é¢‘èµ„æº');
            } else {
                audio.pause();
                icon.className = 'fas fa-music';
            }
        }

        // æ’­æ”¾å®ŒæˆéŸ³æ•ˆ
        function playCompletionSound() {
            // å¯ä»¥æ·»åŠ å®ŒæˆéŸ³æ•ˆ
            // const audio = new Audio('path/to/completion.mp3');
            // audio.play();
        }

        // è¿”å›
        function goBack() {
            if (isRunning && !confirm('æ­£åœ¨ä¸“æ³¨ä¸­ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ')) {
                return;
            }
            window.location.href = 'student-dashboard.html';
        }

        // é¡µé¢å…³é—­å‰æç¤º
        window.addEventListener('beforeunload', (e) => {
            if (isRunning) {
                e.preventDefault();
                e.returnValue = 'æ­£åœ¨ä¸“æ³¨ä¸­ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
            }
        });
    </script>
</body>
</html>


