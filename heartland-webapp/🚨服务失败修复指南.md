# 🚨 服务失败修复指南

## 当前问题

您的 `heartland-backend` 服务显示 **"Failed service"**（红色 X 标记），这意味着服务已崩溃或停止。

## 修复步骤

### 方法 1：重启服务（推荐，先尝试）

1. **点击服务名称**
   - 点击 "heartland-backend" 进入服务详情页

2. **查看日志**
   - 切换到 **"Logs"** 标签页
   - 查看错误信息，了解失败原因

3. **重启服务**
   - 点击右上角的 **"..."** 菜单
   - 选择 **"Restart"**

4. **等待启动**
   - 等待 1-2 分钟
   - 状态应该变为 "Live"（绿色）

### 方法 2：重新部署（如果重启失败）

1. **进入服务详情**
   - 点击 "heartland-backend" 服务

2. **查看 "Events" 或 "Logs"**
   - 找到失败的原因
   - 常见原因：
     - 环境变量缺失
     - 代码错误
     - 依赖安装失败
     - 端口配置错误

3. **手动重新部署**
   - 点击 **"Manual Deploy"** 按钮
   - 选择 **"Deploy latest commit"**
   - 或选择特定 commit

### 方法 3：检查环境变量（如果部署失败）

1. **进入服务设置**
   - 点击服务名称 → **"Settings"** 标签

2. **检查环境变量**
   确保以下变量已配置：
   ```
   NODE_ENV=production
   PORT=10000 (Render 默认端口)
   JWT_SECRET=您的密钥
   SUPABASE_URL=您的 Supabase URL
   SUPABASE_KEY=您的 Supabase 密钥
   SUPABASE_SERVICE_KEY=您的 Supabase Service Key
   FRONTEND_URL=https://heartland-webapp.vercel.app
   ```

3. **如果缺少变量**
   - 点击 **"Environment"** 或 **"Environment Variables"**
   - 添加缺失的变量
   - 保存并重新部署

## 快速诊断

### 步骤 1：查看日志

1. 点击 "heartland-backend" 服务
2. 切换到 **"Logs"** 标签
3. 查看最新的错误信息

### 常见错误及解决方法

#### 错误 1：端口错误
```
Error: listen EADDRINUSE: address already in use :::3000
```
**解决**：使用 Render 的环境变量 `PORT`，不要硬编码端口

#### 错误 2：环境变量缺失
```
Error: SUPABASE_URL is not defined
```
**解决**：在 Settings → Environment 中添加所有必需的环境变量

#### 错误 3：依赖安装失败
```
npm ERR! code ERESOLVE
```
**解决**：检查 package.json，可能需要更新依赖版本

#### 错误 4：数据库连接失败
```
Error: Failed to connect to database
```
**解决**：检查 Supabase 配置和网络连接

## 立即操作

### ✅ 第一步：点击服务名称
点击 "heartland-backend" 进入详情页

### ✅ 第二步：查看日志
在服务详情页切换到 "Logs" 标签，告诉我看到了什么错误信息

### ✅ 第三步：尝试重启
- 点击右上角 "..." → "Restart"
- 或点击 "Manual Deploy" → "Deploy latest commit"

### ✅ 第四步：等待并检查
- 等待 1-2 分钟
- 刷新页面查看状态是否变为 "Live"

## 需要帮助？

如果重启后仍然失败，请提供：
1. Logs 标签页中的错误信息
2. Events 标签页中的最新事件
3. Settings → Environment 中的环境变量列表（隐藏敏感信息）

## 预防措施

修复后，建议：
1. ✅ 设置健康检查端点（`/health`）
2. ✅ 配置自动重启策略
3. ✅ 设置监控和告警
4. ✅ 定期查看日志


