# 🔧 快速诊断和修复指南

## 当前错误分析

您遇到的错误：
- `404` - 资源未找到
- `ERR_CONNECTION_CLOSED` - 连接被关闭

这通常意味着：**后端服务未运行或 URL 配置不正确**

## 步骤 1: 确认您的 Render 后端 URL

1. **登录 Render Dashboard**
   - 访问：https://dashboard.render.com/
   - 登录您的账户

2. **找到后端服务**
   - 在 Dashboard 中找到您的后端服务（可能是 `heartland-backend` 或其他名称）
   - 点击进入服务详情

3. **查看 Public URL**
   - 在服务详情页面，找到 **Public URL** 或 **URL**
   - 格式应该是：`https://xxx.onrender.com`

4. **检查服务状态**
   - 确保状态显示为 **"Live"**（绿色）
   - 如果显示 **"Stopped"** 或 **"Paused"**，请点击 **"Manual Deploy"** 或 **"Restart"**

## 步骤 2: 测试后端连接

在浏览器中打开新标签页，访问：

```
https://您的后端URL.onrender.com/health
```

例如，如果您的 URL 是 `https://heartland-backend.onrender.com`，则访问：
```
https://heartland-backend.onrender.com/health
```

**正常响应应该是：**
```json
{
  "status": "ok",
  "timestamp": "2024-01-01T00:00:00.000Z",
  "service": "心屿学院API",
  "version": "1.0.0"
}
```

**如果看到错误：**
- ❌ 404 - URL 不正确或路由配置错误
- ❌ 无法访问 - 服务未启动
- ❌ 超时 - 服务正在启动（等待 1-2 分钟再试）

## 步骤 3: 更新配置

如果您的 Render URL 与配置不同，请更新：

1. **打开文件**：`heartland-webapp/frontend/config.js`

2. **找到这一行**（约第 16 行）：
```javascript
BASE_URL: 'https://heartland-backend.onrender.com/api',
```

3. **替换为您的实际 URL**，确保：
   - ✅ 以 `https://` 开头
   - ✅ 以 `/api` 结尾
   - ✅ 没有多余的斜杠

例如，如果您的 URL 是 `https://my-backend-123.onrender.com`，则改为：
```javascript
BASE_URL: 'https://my-backend-123.onrender.com/api',
```

## 步骤 4: 重新测试

1. **清除浏览器缓存**
   - 按 `Ctrl + Shift + Delete`（Windows）或 `Cmd + Shift + Delete`（Mac）
   - 选择清除缓存和 Cookie

2. **刷新页面**
   - 按 `Ctrl + F5`（Windows）或 `Cmd + Shift + R`（Mac）强制刷新

3. **打开浏览器控制台**
   - 按 `F12` 打开开发者工具
   - 切换到 **Console** 标签页
   - 查看页面加载时的诊断信息

4. **尝试登录**
   - 输入手机号和密码
   - 观察控制台输出的详细信息

## 步骤 5: 查看诊断信息

页面加载时，控制台会显示：
- ✅ 配置的 API BASE_URL
- ✅ 实际使用的 baseURL
- ✅ 后端健康检查结果

如果看到 `❌ 无法连接到后端`，请：
1. 确认 Render 服务状态为 "Live"
2. 确认 URL 配置正确
3. 尝试在浏览器中直接访问健康检查 URL

## 常见问题

### Q1: Render 服务一直显示 "Starting"
**A:** 免费服务启动较慢，通常需要 1-2 分钟。请等待服务完全启动。

### Q2: 如何查看 Render 服务日志？
**A:** 
1. 在 Render Dashboard 中点击您的服务
2. 切换到 **"Logs"** 标签页
3. 查看最新的日志输出

### Q3: 如何重启 Render 服务？
**A:** 
1. 在服务详情页面
2. 点击右上角的 **"..."** 菜单
3. 选择 **"Restart"**

### Q4: 后端健康检查返回 404
**A:** 
- 检查后端路由配置
- 确认 `/health` 路由已正确设置
- 查看后端日志

### Q5: CORS 错误
**A:** 
在 Render 环境变量中添加：
- 键：`FRONTEND_URL`
- 值：`https://heartland-webapp.vercel.app`

## 需要帮助？

如果问题仍然存在，请提供：
1. ✅ 您的 Render 后端 URL
2. ✅ Render Dashboard 中的服务状态
3. ✅ 浏览器控制台的完整错误信息
4. ✅ `/health` 端点的测试结果


